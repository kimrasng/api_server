<!DOCTYPE html>
<html lang="kr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Music App</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #121212;
      color: #fff;
      margin: 0;
      padding: 0;
    }

    .container {
      display: flex;
      max-width: 1200px;
      margin: 20px auto;
      padding: 20px;
      background-color: #1e1e1e;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    .left-panel, .right-panel {
      flex: 1;
      padding: 20px;
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
    }

    #current-song {
      text-align: center;
      margin-bottom: 20px;
    }

    #song-image-container {
      text-align: center;
    }

    #song-image-container img {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
    }

    #audio-player {
      display: block;
      margin: 20px auto;
      width: 90%;
    }

    #search-input {
      width: 100%;
      padding: 10px;
      margin-bottom: 20px;
      border-radius: 4px;
      border: 1px solid #333;
      background-color: #333;
      color: #fff;
      transition: background-color 0.3s ease;
    }

    #search-input:hover {
      background-color: #444;
    }

    ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    li {
      padding: 10px;
      background-color: #333;
      border-radius: 4px;
      margin-bottom: 5px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    li:hover {
      background-color: #444;
    }

    li span {
      color: #ccc;
      margin-left: 10px;
    }

    .pagination {
      display: flex;
      justify-content: center;
      margin-top: 20px;
    }

    .pagination button {
      margin: 0 5px;
      padding: 5px 10px;
      background-color: #007bff;
      border: none;
      border-radius: 4px;
      color: #fff;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .pagination button:hover {
      background-color: #0056b3;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="left-panel">
      <h1>Music App</h1>

      <!-- 플레이 -->
      <div id="current-song">
        <h2 id="song-title"></h2>
        <h3 id="artist-name"></h3>
        <div id="song-image-container">
          <img src="" id="song-image" alt="Song Image">
        </div>
        <audio src="" id="audio-player" controls controlsList="nodownload noduration nodownload"></audio>
      </div>
    </div>

    <div class="right-panel">
      <!-- 리스트 -->
      <input type="text" id="search-input" placeholder="Search...">
      <ul id="song-list"></ul>
      <div class="pagination" id="pagination"></div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const songList = document.getElementById('song-list');
      const paginationContainer = document.getElementById('pagination');
      let currentPage = 1;
      let songsPerPage = 10;
      let currentSongIndex = 0;

      // 다음 곡을 재생하는 함수
      const playNextSong = () => {
        const songs = songList.querySelectorAll('li');
        const nextSongIndex = (currentSongIndex + 1) % songs.length;
        const nextSong = songs[nextSongIndex];
        
        // 만약 다음 곡이 새로운 페이지의 첫 번째 곡이라면, 다음 페이지의 곡을 가져와 렌더링한다
        if (nextSongIndex === 0) {
          currentPage++;
          fetchAndRenderSongs();
        }
        
        // 다음 곡을 재생한다
        nextSong.click();
      };

      const playSong = (song) => {
        const audioPlayer = document.getElementById('audio-player');
        const songTitle = document.getElementById('song-title');
        const artistName = document.getElementById('artist-name');
        const songImage = document.getElementById('song-image');

        audioPlayer.src = `https://api.kimrasng.kro.kr/api/music-server/music/${song.filename}`;
        songTitle.textContent = `${song.title}`;
        artistName.textContent = `Artist: ${song.artist_name}`;

        if (song.image_filename) {
          songImage.src = `https://api.kimrasng.kro.kr/api/music-server/img/song/${song.image_filename}`;
        } else {
          songImage.src = 'placeholder_image.jpg';
        }

        audioPlayer.play();
      };

      const renderSongs = (songs) => {
        songList.innerHTML = '';
        const startIndex = (currentPage - 1) * songsPerPage;
        const endIndex = startIndex + songsPerPage;
        const currentSongs = songs.slice(startIndex, endIndex);
        currentSongs.forEach((song, index) => {
          const li = document.createElement('li');
          li.textContent = `${song.title}`;
          const artistSpan = document.createElement('span');
          artistSpan.textContent = `${song.artist_name}`;
          li.appendChild(artistSpan);
          li.addEventListener('click', () => {
            currentSongIndex = index + startIndex;
            playSong(song);
          });
          songList.appendChild(li);
        });
        renderPagination(songs.length);
      };

      const renderPagination = (totalSongs) => {
        paginationContainer.innerHTML = '';
        const totalPages = Math.ceil(totalSongs / songsPerPage);
        for (let i = 1; i <= totalPages; i++) {
          const button = document.createElement('button');
          button.textContent = i;
          button.addEventListener('click', () => {
            currentPage = i;
            fetchAndRenderSongs();
          });
          paginationContainer.appendChild(button);
        }
      };

      const fetchAndRenderSongs = () => {
        fetch(`https://api.kimrasng.kro.kr/api/music-server/songs`)
          .then(response => response.json())
          .then(data => {
            renderSongs(data.songs);
            // 오디오가 끝날 때마다 다음 곡을 재생
            const audioPlayer = document.getElementById('audio-player');
            audioPlayer.addEventListener('ended', playNextSong);
          })
          .catch(error => console.error('Error fetching songs:', error));
      };

      // 초기화
      fetchAndRenderSongs();

      // 검색 기능 추가
      const searchInput = document.getElementById('search-input');
      searchInput.addEventListener('input', () => {
        const searchValue = searchInput.value.toLowerCase();
        currentPage = 1; // Set current page to 1
        fetch(`https://api.kimrasng.kro.kr/api/music-server/songs`)
          .then(response => response.json())
          .then(data => {
        const filteredSongs = data.songs.filter(song => {
          return song.title.toLowerCase().includes(searchValue) || song.artist_name.toLowerCase().includes(searchValue);
        });
        renderSongs(filteredSongs);
          })
          .catch(error => console.error('Error searching songs:', error));
      });
    });
  </script>
</body>
</html>
